{
  "info": {
    "name": "ERPS Partner Portal - Complete API Collection",
    "description": "Complete Postman collection for ERPS (Electronic Rust Protection System) Partner Portal covering all functionality including authentication, partner management, warranty registration, annual inspections, and SMS verification workflows.",
    "version": "1.0.0",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:5050/api/v1",
      "type": "string"
    },
    {
      "key": "adminToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "accountAdminToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "accountStaffToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "accountInstallerToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "partnerAccountId",
      "value": "",
      "type": "string"
    },
    {
      "key": "warrantyId",
      "value": "",
      "type": "string"
    },
    {
      "key": "inspectionId",
      "value": "",
      "type": "string"
    },
    {
      "key": "verificationToken",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "üîê Authentication",
      "description": "User authentication endpoints for all ERPS user roles",
      "item": [
        {
          "name": "Login - ERPS Admin",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.token) {",
                  "        pm.collectionVariables.set('adminToken', response.data.token);",
                  "        console.log('‚úÖ ERPS Admin token saved');",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@erps.com\",\n  \"password\": \"admin123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Login as ERPS Admin - has full platform governance and oversight capabilities"
          }
        },
        {
          "name": "Login - Account Admin",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.token) {",
                  "        pm.collectionVariables.set('accountAdminToken', response.data.token);",
                  "        console.log('‚úÖ Account Admin token saved');",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@testauto.com\",\n  \"password\": \"admin123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Login as Account Admin - manages partner account and users, can create/submit warranties and inspections"
          }
        },
        {
          "name": "Login - Account Staff",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.token) {",
                  "        pm.collectionVariables.set('accountStaffToken', response.data.token);",
                  "        console.log('‚úÖ Account Staff token saved');",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"staff@testauto.com\",\n  \"password\": \"staff123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Login as Account Staff - day-to-day administration, can create/submit warranties and inspections but cannot verify"
          }
        },
        {
          "name": "Login - Account Installer",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.token) {",
                  "        pm.collectionVariables.set('accountInstallerToken', response.data.token);",
                  "        console.log('‚úÖ Account Installer token saved');",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"installer@testauto.com\",\n  \"password\": \"installer123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Login as Account Installer - ERPS Authorised Installer who performs installations/inspections and must verify via SMS"
          }
        }
      ]
    },
    {
      "name": "üëë ERPS Admin Management",
      "description": "ERPS Admin only endpoints for platform governance and oversight",
      "item": [
        {
          "name": "Get All Partner Users",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/auth/admin/partner-users",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "admin", "partner-users"]
            },
            "description": "Get all partner users across the platform (ERPS Admin only)"
          }
        },
        {
          "name": "Get All Installers",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/auth/admin/installers",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "admin", "installers"]
            },
            "description": "Get all ERPS Authorised Installers across the platform (ERPS Admin only)"
          }
        },
        {
          "name": "Admin Login As Partner User",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"targetUserId\": \"USER_ID_HERE\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/admin/login-as",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "admin", "login-as"]
            },
            "description": "Admin impersonation - login as any partner user (ERPS Admin only)"
          }
        }
      ]
    },
    {
      "name": "üè¢ Partner Account Management",
      "description": "Partner account and user management endpoints",
      "item": [
        {
          "name": "Create Partner Account",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.partnerAccount && response.data.partnerAccount.id) {",
                  "        pm.collectionVariables.set('partnerAccountId', response.data.partnerAccount.id);",
                  "        console.log('‚úÖ Partner Account ID saved:', response.data.partnerAccount.id);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"businessName\": \"Test Auto Services\",\n  \"contactName\": \"John Smith\",\n  \"email\": \"contact@testauto.com\",\n  \"phone\": \"+61412345678\",\n  \"address\": \"123 Main Street\",\n  \"city\": \"Sydney\",\n  \"state\": \"NSW\",\n  \"postcode\": \"2000\",\n  \"adminUser\": {\n    \"fullName\": \"John Smith\",\n    \"email\": \"admin@testauto.com\",\n    \"password\": \"admin123\",\n    \"mobileNumber\": \"+61412345678\"\n  }\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/admin/partner-accounts",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "partner-accounts"]
            },
            "description": "Create new partner account with admin user (ERPS Admin only)"
          }
        },
        {
          "name": "Get All Partner Accounts",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/partner-accounts",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "partner-accounts"]
            },
            "description": "Get all partner accounts (ERPS Admin only)"
          }
        },
        {
          "name": "Get Partner Account by ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accountAdminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/partner-accounts/{{partnerAccountId}}",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "partner-accounts", "{{partnerAccountId}}"]
            },
            "description": "Get partner account details (ERPS Admin or Account Admin for own account)"
          }
        },
        {
          "name": "Update Partner Account",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accountAdminToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"businessName\": \"Test Auto Services Updated\",\n  \"contactName\": \"John Smith\",\n  \"phone\": \"+61412345679\",\n  \"address\": \"456 Updated Street\",\n  \"city\": \"Melbourne\",\n  \"state\": \"VIC\",\n  \"postcode\": \"3000\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/admin/partner-accounts/{{partnerAccountId}}",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "partner-accounts", "{{partnerAccountId}}"]
            },
            "description": "Update partner account details (ERPS Admin or Account Admin for own account)"
          }
        },
        {
          "name": "Create Partner User - Account Staff",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accountAdminToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fullName\": \"Sarah Johnson\",\n  \"email\": \"staff@testauto.com\",\n  \"password\": \"staff123\",\n  \"partnerRole\": \"ACCOUNT_STAFF\",\n  \"mobileNumber\": \"+61423456789\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/admin/partner-accounts/{{partnerAccountId}}/users",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "partner-accounts", "{{partnerAccountId}}", "users"]
            },
            "description": "Create Account Staff user in partner account (ERPS Admin or Account Admin)"
          }
        },
        {
          "name": "Create Partner User - Account Installer",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accountAdminToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fullName\": \"Mike Johnson\",\n  \"email\": \"installer@testauto.com\",\n  \"password\": \"installer123\",\n  \"partnerRole\": \"ACCOUNT_INSTALLER\",\n  \"mobileNumber\": \"+61434567890\",\n  \"installerLicenseNumber\": \"ERPS-INST-001\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/admin/partner-accounts/{{partnerAccountId}}/users",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "partner-accounts", "{{partnerAccountId}}", "users"]
            },
            "description": "Create Account Installer (ERPS Authorised Installer) in partner account (ERPS Admin or Account Admin)"
          }
        },
        {
          "name": "Get Partner Users",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accountAdminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/partner-accounts/{{partnerAccountId}}/users",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "partner-accounts", "{{partnerAccountId}}", "users"]
            },
            "description": "Get all users in partner account (ERPS Admin or Account Admin)"
          }
        }
      ]
    },
    {
      "name": "üìã Warranty Registration Workflow",
      "description": "Complete warranty registration process according to ERPS requirements",
      "item": [
        {
          "name": "Create Warranty Registration (Draft)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// This is a database operation example - actual API endpoint would be implemented",
                  "console.log('üìã Warranty registration created in DRAFT status');",
                  "console.log('Status: DRAFT - can be edited, photos optional, not valid until submitted and verified');"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accountStaffToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"companyName\": \"ABC Motors\",\n  \"firstName\": \"John\",\n  \"lastName\": \"Smith\",\n  \"phoneNumber\": \"+61412345678\",\n  \"email\": \"john.smith@example.com\",\n  \"make\": \"Toyota\",\n  \"model\": \"Camry\",\n  \"registrationNumber\": \"ABC123\",\n  \"buildDate\": \"2023-01-15\",\n  \"vinNumber\": \"JTDKN3DU5E0123456\",\n  \"installersName\": \"Mike Johnson\",\n  \"installerId\": \"INSTALLER_USER_ID\",\n  \"dateInstalled\": \"2024-12-01\",\n  \"generatorSerialNumber\": \"GEN-2024-001\",\n  \"numberOfCouplersInstalled\": 4,\n  \"voltageInCouplerSupplyLine\": 12.5,\n  \"positionOfCouplers\": \"Front: LF, RF; Rear: LR, RR\",\n  \"corrosionFound\": false,\n  \"installationConfirmed\": true,\n  \"status\": \"DRAFT\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/warranties",
              "host": ["{{baseUrl}}"],
              "path": ["warranties"]
            },
            "description": "Create warranty registration in DRAFT status - can be incomplete, photos optional, not valid until submitted and verified"
          }
        },
        {
          "name": "Submit Warranty for Verification",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "console.log('üìã Warranty submitted for verification');",
                  "console.log('Status: SUBMITTED - Pending Verification');",
                  "console.log('üì± SMS verification sent to installer mobile number');",
                  "console.log('üîí Record locked - cannot be edited until verified or declined');"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accountStaffToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"verificationStatus\": \"SUBMITTED\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/warranties/{{warrantyId}}/submit",
              "host": ["{{baseUrl}}"],
              "path": ["warranties", "{{warrantyId}}", "submit"]
            },
            "description": "Submit warranty for verification - triggers SMS to installer, locks record, status becomes SUBMITTED"
          }
        },
        {
          "name": "Upload Warranty Photos",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accountStaffToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "photos",
                  "type": "file",
                  "src": []
                },
                {
                  "key": "photoGroup",
                  "value": "GENERATOR_INSTALLED",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/warranties/{{warrantyId}}/photos",
              "host": ["{{baseUrl}}"],
              "path": ["warranties", "{{warrantyId}}", "photos"]
            },
            "description": "Upload mandatory photos - minimum 3 required: Generator installed, Coupler pads, Corrosion or clear body"
          }
        }
      ]
    },
    {
      "name": "üîç Annual Inspection Workflow",
      "description": "Complete annual inspection process according to ERPS requirements",
      "item": [
        {
          "name": "Create Annual Inspection (Draft)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "console.log('üîç Annual inspection created in DRAFT status');",
                  "console.log('Status: DRAFT - can be edited, photos optional, not valid until submitted and verified');"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accountStaffToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"warrantyId\": \"{{warrantyId}}\",\n  \"inspectorId\": \"INSTALLER_USER_ID\",\n  \"inspectionDate\": \"2024-12-24\",\n  \"generatorMountedCorrectly\": true,\n  \"redLightIlluminated\": true,\n  \"couplersSecureSealed\": true,\n  \"roofTurretCondition\": \"PASS\",\n  \"pillarsCondition\": \"PASS\",\n  \"sillsCondition\": \"PASS\",\n  \"guardsLfCondition\": \"PASS\",\n  \"guardsRfCondition\": \"PASS\",\n  \"guardsLrCondition\": \"PASS\",\n  \"guardsRrCondition\": \"PASS\",\n  \"innerGuardsCondition\": \"PASS\",\n  \"underBonnetCondition\": \"PASS\",\n  \"firewallCondition\": \"PASS\",\n  \"bootWaterIngressCondition\": \"PASS\",\n  \"underbodySeamsCondition\": \"PASS\",\n  \"ownerAdvisedPaintDamage\": true,\n  \"ownerUnderstandsOperation\": true,\n  \"corrosionFound\": false,\n  \"verificationStatus\": \"DRAFT\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/inspections",
              "host": ["{{baseUrl}}"],
              "path": ["inspections"]
            },
            "description": "Create annual inspection in DRAFT status - includes complete inspection checklist"
          }
        },
        {
          "name": "Submit Inspection for Verification",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "console.log('üîç Inspection submitted for verification');",
                  "console.log('Status: SUBMITTED - Pending Verification');",
                  "console.log('üì± SMS verification sent to inspector mobile number');",
                  "console.log('üîí Record locked - cannot be edited until verified or declined');"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accountStaffToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"verificationStatus\": \"SUBMITTED\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/inspections/{{inspectionId}}/submit",
              "host": ["{{baseUrl}}"],
              "path": ["inspections", "{{inspectionId}}", "submit"]
            },
            "description": "Submit inspection for verification - triggers SMS to inspector, locks record, status becomes SUBMITTED"
          }
        },
        {
          "name": "Upload Inspection Photos",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accountStaffToken}}"
              }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "photos",
                  "type": "file",
                  "src": []
                },
                {
                  "key": "photoGroup",
                  "value": "GENERATOR_RED_LIGHT",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/inspections/{{inspectionId}}/photos",
              "host": ["{{baseUrl}}"],
              "path": ["inspections", "{{inspectionId}}", "photos"]
            },
            "description": "Upload mandatory photos - minimum 3 required: Generator/RED light, Couplers condition, Corrosion or clear body"
          }
        }
      ]
    },
    {
      "name": "üì± SMS Verification (Public Endpoints)",
      "description": "Public verification endpoints accessed via SMS links - no authentication required",
      "item": [
        {
          "name": "Get Verification Details",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    console.log('üì± Verification details retrieved');",
                  "    console.log('Type:', response.data.verificationType);",
                  "    console.log('Expires:', response.data.expiresAt);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/verify/{{verificationToken}}",
              "host": ["{{baseUrl}}"],
              "path": ["verify", "{{verificationToken}}"]
            },
            "description": "Get verification details from SMS token - shows installer/inspector all data to review before confirming or declining"
          }
        },
        {
          "name": "Confirm Warranty Verification",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    console.log('‚úÖ Warranty VERIFIED successfully');",
                  "    console.log('Status: VERIFIED - Warranty is now ACTIVE');",
                  "    console.log('üéâ Customer warranty protection begins');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"action\": \"CONFIRM\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/verify/warranty/{{verificationToken}}",
              "host": ["{{baseUrl}}"],
              "path": ["verify", "warranty", "{{verificationToken}}"]
            },
            "description": "Installer confirms warranty via SMS link - warranty becomes VERIFIED and ACTIVE"
          }
        },
        {
          "name": "Decline Warranty Verification",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    console.log('‚ùå Warranty DECLINED by installer');",
                  "    console.log('Status: REJECTED - Record unlocked for correction');",
                  "    console.log('üìù Decline reason recorded for audit trail');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"action\": \"DECLINE\",\n  \"declineReason\": \"Installation details are incorrect - wrong vehicle information provided\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/verify/warranty/{{verificationToken}}",
              "host": ["{{baseUrl}}"],
              "path": ["verify", "warranty", "{{verificationToken}}"]
            },
            "description": "Installer declines warranty via SMS link - warranty becomes REJECTED, record unlocks for correction"
          }
        },
        {
          "name": "Confirm Inspection Verification",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    console.log('‚úÖ Inspection VERIFIED successfully');",
                  "    console.log('Status: VERIFIED - Inspection complete');",
                  "    console.log('üìÖ Warranty extended 12 months from verification date');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"action\": \"CONFIRM\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/verify/inspection/{{verificationToken}}",
              "host": ["{{baseUrl}}"],
              "path": ["verify", "inspection", "{{verificationToken}}"]
            },
            "description": "Inspector confirms inspection via SMS link - inspection becomes VERIFIED, warranty extended 12 months"
          }
        },
        {
          "name": "Decline Inspection Verification",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    console.log('‚ùå Inspection DECLINED by inspector');",
                  "    console.log('Status: REJECTED - Record unlocked for correction');",
                  "    console.log('üìù Decline reason recorded, no warranty extension');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"action\": \"DECLINE\",\n  \"declineReason\": \"Inspection checklist incomplete - corrosion found but not properly documented\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/verify/inspection/{{verificationToken}}",
              "host": ["{{baseUrl}}"],
              "path": ["verify", "inspection", "{{verificationToken}}"]
            },
            "description": "Inspector declines inspection via SMS link - inspection becomes REJECTED, record unlocks for correction"
          }
        }
      ]
    },
    {
      "name": "üîß Admin Verification Management",
      "description": "ERPS Admin tools for verification oversight and management",
      "item": [
        {
          "name": "Resend Verification SMS",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    console.log('üì± Verification SMS resent successfully');",
                  "    console.log('New 24-hour verification window started');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"recordId\": \"{{warrantyId}}\",\n  \"recordType\": \"WARRANTY\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/verify/resend",
              "host": ["{{baseUrl}}"],
              "path": ["verify", "resend"]
            },
            "description": "Resend verification SMS to installer/inspector (ERPS Admin only)"
          }
        },
        {
          "name": "Get Installer Verification History",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    console.log('üìä Installer verification history retrieved');",
                  "    console.log('Installer:', response.data.installer.fullName);",
                  "    console.log('Warranties:', response.data.warranties.length);",
                  "    console.log('Inspections:', response.data.inspections.length);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/verify/history/INSTALLER_USER_ID",
              "host": ["{{baseUrl}}"],
              "path": ["verify", "history", "INSTALLER_USER_ID"]
            },
            "description": "Get complete verification history for an installer - all warranties and inspections they've verified (ERPS Admin only)"
          }
        }
      ]
    },
    {
      "name": "üß™ Access Control Tests",
      "description": "Test role-based access control enforcement",
      "item": [
        {
          "name": "Test: Account Staff Access Admin Endpoint (Should Fail)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Access denied for Account Staff', function () {",
                  "    pm.expect(pm.response.code).to.equal(403);",
                  "});",
                  "console.log('‚úÖ Access control working - Account Staff correctly denied admin access');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accountStaffToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/auth/admin/partner-users",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "admin", "partner-users"]
            },
            "description": "Test that Account Staff cannot access ERPS Admin endpoints - should return 403"
          }
        },
        {
          "name": "Test: Account Installer Access Admin Endpoint (Should Fail)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Access denied for Account Installer', function () {",
                  "    pm.expect(pm.response.code).to.equal(403);",
                  "});",
                  "console.log('‚úÖ Access control working - Account Installer correctly denied admin access');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accountInstallerToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/auth/admin/installers",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "admin", "installers"]
            },
            "description": "Test that Account Installer cannot access ERPS Admin endpoints - should return 403"
          }
        },
        {
          "name": "Test: Account Staff Access Own Partner Account (Should Pass)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Access granted for own partner account', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "});",
                  "console.log('‚úÖ Access control working - Account Staff can access own partner account');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{accountStaffToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/partner-accounts/{{partnerAccountId}}",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "partner-accounts", "{{partnerAccountId}}"]
            },
            "description": "Test that Account Staff can access their own partner account - should return 200"
          }
        }
      ]
    },
    {
      "name": "üìä System Status & Reports",
      "description": "System status and reporting endpoints",
      "item": [
        {
          "name": "Get System Statistics",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    console.log('üìä System Statistics:');",
                  "    console.log('Total Users:', response.data.totalUsers);",
                  "    console.log('Partner Accounts:', response.data.partnerAccounts);",
                  "    console.log('Active Warranties:', response.data.activeWarranties);",
                  "    console.log('Pending Verifications:', response.data.pendingVerifications);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/statistics",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "statistics"]
            },
            "description": "Get system-wide statistics and health metrics (ERPS Admin only)"
          }
        },
        {
          "name": "Get Pending Verifications Report",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/reports/pending-verifications",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "reports", "pending-verifications"]
            },
            "description": "Get report of all pending verifications across the platform (ERPS Admin only)"
          }
        },
        {
          "name": "Get Warranty Compliance Report",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/reports/warranty-compliance",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "reports", "warranty-compliance"]
            },
            "description": "Get warranty compliance report - due inspections, grace periods, expired warranties (ERPS Admin only)"
          }
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Global pre-request script",
          "console.log('üöÄ ERPS API Request:', pm.info.requestName);"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Global test script",
          "pm.test('Response time is acceptable', function () {",
          "    pm.expect(pm.response.responseTime).to.be.below(5000);",
          "});",
          "",
          "if (pm.response.code >= 400) {",
          "    console.log('‚ùå Error Response:', pm.response.json());",
          "} else {",
          "    console.log('‚úÖ Success Response Code:', pm.response.code);",
          "}"
        ]
      }
    }
  ]
}